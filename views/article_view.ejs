<html>
<head>
<% include head %>
<script>
function vax(meth,url,data,onLoad,onError){
var xhr=new XMLHttpRequest();
xhr.open(meth,url);
xhr.setRequestHeader("Content-Type","application/json");
xhr.onload=onLoad;
xhr.onerror=onError;
xhr.send(data);
} 

function onLoad(e){
if(this.status==200){
console.log(this.responseText);alert('ok');
}
}
function onError(e){alert('fuck');}
</script></head>
<body class="wrapper">
<header>
<% include header %>
</header>
<main class="main-wr">
<% if(article !== null){%>
<ul>
<li>
<%=article._id %>
</li>
<li><b>Name of article:</b> <div id="divHeader" contenteditable=false>
<%= article.article %></div>

</li>
<li>
<b>By:</b> <%= article.autor %>
</li>
<li><b>Quick description:</b>
<div id="divDescription" contenteditable=false><%= article.content %></div>
</li>
<li>
<b>Edited:</b> <%= article.redaktiert %>
</li>
<li><% if(user){%>
<b>Visibility:</b> <%= article.visible %><input id="checkvis" type="checkbox" data-vis="<%= article.visible %>" onchange="doUnvisible(this)"><%}%>
</li>
<li><b>Content:</b> 
<%= article.dascription %>
</br><b>Content:</b>
<div id="divContent"  data-id="<%= article._id %>" style="background-color:lightgray;" contenteditable=false><%- article.dascription %></div>
</li>
<li><b>Created:</b>
<%= article.created %>
</li>
<ul>
<%}%>
</br>
<% if(user){%>
<span id=indigo class="loading" style="background-color:blue;"></span>
<button id=quickRedact onclick="quickRedact(this)">Quick edit</button>

 | 
<button onclick="saveQuickEdit(this)">save all</button>

<span id=status></span>
<%}%>

<!-- administrative for redactor -->


<% if(user){%>

***************
*****************************
*****************************
<span id="out"></span>
<style>
.main {
    background: #aaa url('/images/pic.png') no-repeat;
    width: 800px;
    height: 600px;
    margin: 50px auto;
}
.panel {
    background-color: #444;
    height: 34px;
    padding: 10px;
}
.panel a#login_pop, .panel a#join_pop {
    border: 2px solid #aaa;
    color: #fff;
    display: block;
    float: right;
    margin-right: 10px;
    padding: 5px 10px;
    text-decoration: none;
    text-shadow: 1px 1px #000;

    -webkit-border-radius: 10px;
    -moz-border-radius: 10px;
    -ms-border-radius: 10px;
    -o-border-radius: 10px;
    border-radius: 10px;
}
a#login_pop:hover, a#join_pop:hover {
    border-color: #eee;
}
.overlay {
    background-color: rgba(0, 0, 0, 0.6);
    bottom: 0;
    cursor: default;
    left: 0;
    opacity: 0;
    position: fixed;
    right: 0;
    top: 0;
    visibility: hidden;
    z-index: 1;

    -webkit-transition: opacity .5s;
    -moz-transition: opacity .5s;
    -ms-transition: opacity .5s;
    -o-transition: opacity .5s;
    transition: opacity .5s;
}
.overlay:target {
    visibility: visible;
    opacity: 1;
}
.popup {
    background-color: #fff;
    border: 3px solid #fff;
    display: inline-block;
    left: 50%;
    opacity: 0;
    padding: 15px;

    position: fixed;
    text-align: justify;
    top: 40%;
    height:300px;
    overflow-y:scroll;
   min-height:50px;
    visibility: hidden;

    z-index: 10;

    -webkit-transform: translate(-50%, -50%);
    -moz-transform: translate(-50%, -50%);
    -ms-transform: translate(-50%, -50%);
    -o-transform: translate(-50%, -50%);
    transform: translate(-50%, -50%);

    -webkit-border-radius: 10px;
    -moz-border-radius: 10px;
    -ms-border-radius: 10px;
    -o-border-radius: 10px;
    border-radius: 10px;

    -webkit-box-shadow: 0 1px 1px 2px rgba(0, 0, 0, 0.4) inset;
    -moz-box-shadow: 0 1px 1px 2px rgba(0, 0, 0, 0.4) inset;
    -ms-box-shadow: 0 1px 1px 2px rgba(0, 0, 0, 0.4) inset;
    -o-box-shadow: 0 1px 1px 2px rgba(0, 0, 0, 0.4) inset;
    box-shadow: 0 1px 1px 2px rgba(0, 0, 0, 0.4) inset;

    -webkit-transition: opacity .5s, top .5s;
    -moz-transition: opacity .5s, top .5s;
    -ms-transition: opacity .5s, top .5s;
    -o-transition: opacity .5s, top .5s;
    transition: opacity .5s, top .5s;
}
.popup:hover{background-color:lightgray;}
.popup::-webkit-scrollbar{width:5px;}
.popup::-webkit-scrollbar:hover{width:5px;background-color:blue;}
.popup::-webkit-scrollbar-track{
box-shadow: inset 0 0 6px rgba(255,0,255,0.3);
border-radius:2px;
}
.popup::-webkit-scrollbar-thumb{
border-radius:2px;

background:rgba(0,255,0,0.8);
box-shadow:inset 0 0 6px rgba(0,0,0,0.5);
}
.popup::-webkit-srcrollbar-thumb:hover{
visisbility:visible;
background-color:rgba(24,255,20,0.6);}
.popup::-webkit-scrollbar-thumb:active{
background:rgba(255,0,0,0.4);
}


.overlay:target+.popup {
    top: 50%;
    opacity: 1;
    visibility: visible;
}
.close {
    background-color: rgba(0, 0, 0, 0.8);
    height: 30px;
    line-height: 30px;
    position: absolute;
    right: 0;
    text-align: center;
    text-decoration: none;
    top: -15px;
    width: 30px;

    -webkit-border-radius: 15px;
    -moz-border-radius: 15px;
    -ms-border-radius: 15px;
    -o-border-radius: 15px;
    border-radius: 15px;
}
.close:before {
    color: rgba(255, 255, 255, 0.9);
    content: "X";
    font-size: 24px;
    text-shadow: 0 -1px rgba(0, 0, 0, 0.9);
}
.close:hover {
    background-color: rgba(64, 128, 128, 0.8);
}
.popup p, .popup div {
    margin-bottom: 10px;
}
.popup label {
    display: inline-block;
    text-align: left;
    width: 120px;
}
.popup input[type="text"], .popup input[type="password"] {
    border: 1px solid;
    border-color: #999 #ccc #ccc;
    margin: 0;
    padding: 2px;

    -webkit-border-radius: 2px;
    -moz-border-radius: 2px;
    -ms-border-radius: 2px;
    -o-border-radius: 2px;
    border-radius: 2px;
}
.popup input[type="text"]:hover, .popup input[type="password"]:hover {
    border-color: #555 #888 #888;
}
</style>

<div class="main">
<div class="panel">
                
<a href="#login_form" id="login_pop">Log In</a>
                
<a href="#join_form" id="join_pop">Change</a>
           
 </div>

<a href="#x" class="overlay" id="login_form"></a>
        
<div class="popup">
            
<h2>Welcome Guest!</h2>
            
<p>Please enter your login and password here</p>
            
<div>
                
<label for="login">Login</label>
                
<input type="text" id="login" value="">
            
</div>
            
<div>
                
<label for="password">Password</label>
                
<input type="password" id="password" value="">
            
</div>
            
<input type="button" value="Log In">

            
<a class="close" href="#"></a>
        
</div>

        
<!-- popup form #2 -->
        
<a href="#x" class="overlay" id="join_form"></a>
        
<div class="popup">
  <span id=indigo class="loading">loading</span>
  <span id="po">popa</span>
     <h2>Text editor</h2>
</br><button onclick="saveArticle(this)">saveArticle</button></br>
<textarea id="articleContent" style="width:400px;height:400px;" value="For edit"></textarea>
</br>
<button onclick="saveArticle(this)">saveArticle</button>   
<h2>Sign Up</h2>
            
<p>Please enter your details here</p>
            
<div>
                
<label for="email">Login (Email)</label>
                
<input type="text" id="email" value="">
            
</div>
            
<div>
                
<label for="pass">Password</label>
                
<input type="password" id="pass" value="">
            
</div>
            
<div>
                
<label for="firstname">First name</label>
                
<input type="text" id="firstname" value="">
            
</div>
    
<div>
                
<label for="lastname">Last name</label>
        
<input type="text" id="lastname" value="">
            
</div>
        
<input type="button" value="Sign Up">&nbsp;&nbsp;&nbsp;or&nbsp;&nbsp;&nbsp;
<a href="#login_form" id="login_pop">Log In</a>

            
<a class="close" href="#"></a>
        
</div>
 
<script>
var join_pop=document.getElementById('join_pop');

var articleContent=document.getElementById('articleContent');
var divHeader=document.getElementById('divHeader');
var divDescription=document.getElementById('divDescription');
var divContent=document.getElementById('divContent');
var out=document.getElementById('out');
var po=document.getElementById('po');
var checkvis=document.getElementById('checkvis');

join_pop.onclick=callRedactor;

function callRedactor(){
//alert('ok');
articleContent.value=divContent.innerHTML;
}

function saveArticle(e){
var errCount=0;
if(articleContent.value === ''){errCount++}
if(errCount === 0){
var data={};
 out.textContent=articleContent.value;

//alert('out.textContent :'+out.textContent);
var numb=divContent.getAttribute('data-id');
//alert('data-id : '+numb);
  data._id=numb;
  data.article=divHeader.innerHTML;
  data.cont=divDescription.innerHTML;
    //data.artBody=divContent.innerHTML;
  data.artBody=out.textContent;
  var data=JSON.stringify(data);
  vax('post','/saveArticle',data,onLoad,onError);

  function onLoad(e){
  out.innerHTML=this.responseText;
  po.innerHTML=this.responseText;
  }
//setTimeout(callDB,1000);
} else
{ alert('Please fill in the field');}
}

function quickRedact(el){
//alert('contenteditable');
status.innerHTML="Contenteditable enabled!";
//divContent.setAttribute('contenteditable',true);
  setEditable('divContent',true);
  setEditable('divHeader',true);
  setEditable('divDescription',true);
el.innerHTML="go edit!";
}
showIndigo("");

function saveQuickEdit(el){
showIndigo("Saving....");
var numb=divContent.getAttribute('data-id');
//alert(divContent.innerHTML);
//alert('data-id :'+numb);
  status.innerHTML=numb+' | '+divContent.innerHTML;
var data={};
    data._id=numb;
    data.article=divHeader.innerHTML;
    data.cont=divDescription.innerHTML;
    data.artBody=divContent.innerHTML;
 var data=JSON.stringify(data);
 vax('post','/saveArticle',data,onLoad,onError);
function onLoad(e){
showIndigo('');
el.innerHTML="saved!";
}
  setEditable('divHeader',false);
  setEditable('divDescription',false);
  setEditable('divContent',false);
  
//divContent.setAttribute('contenteditable',false);
}

function setEditable(id, bool){
document.getElementById(id).setAttribute('contenteditable', bool);
}

 function doUnvisible(el){
alert(el.getAttribute('data-vis'));
}

function showIndigo(text){
var indigo=document.getElementById('indigo');  
    indigo.innerHTML=text;}
</script>
<%}%>
</main>
<footer><% include footer %></footer>
</body>
</html>